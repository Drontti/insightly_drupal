<?php


$my_form;

function insightly_drupal_form_entityform_edit_form_alter(&$form, &$form_state) {
 
 global $my_form;
 $my_form=$form;
 $form['actions']['submit']['#submit'] = array('entityform_edit_form_submit','insightly_drupal_submithook');
}


function insightly_drupal_submithook(){
 global $my_form;

 $last_name=$my_form['#entity']->field_last_name['und'][0]['value'];
 $first_name=$my_form['#entity']->field_first_name['und'][0]['value'];
 $phone_number=$my_form['#entity']->field_phone_number['und'][0]['value']; 

 date_default_timezone_set('UTC');
 $date=date('d.m.Y H:i:s e');
/* 
 $contact='{
	"CONTACT_INFOS" : [
		{
			"DETAIL": "'.$phone_number.'",
			"TYPE": "Phone"
		}
	],
	"DATE_CREATED_UTC": "'.$date.'",
	"FIRST_NAME": "'.$first_name.'",
	"LAST_NAME": "'.$last_name.'",
}';*/

 $contact_array=array('FIRST_NAME'=>$first_name,'LAST_NAME'=>$last_name,'DATE_CREATED_UTC'=>$date,'CONTACT_INFOS'=>array('TYPE'=>'Phone','DETAIL'=>$phone_number));
 $contact=json_encode($contact_array);

 dpm($contact);
 

 $URL='https://api.insight.ly/v2.1/Contacts';
 $ch = curl_init($URL);

 curl_setopt($ch, 
            CURLOPT_HTTPHEADER, 
            array('Content-Type: application/json', 
                  'Authorization: Basic NWUzMDBjNmQtZDkzYy00OWViLTgyYWYtNzdjNmFmMzFhNzBi'));
 curl_setopt($ch , CURLOPT_HEADER, 0);           
 curl_setopt($ch , CURLOPT_TIMEOUT, 30);           
 curl_setopt($ch, CURLOPT_HTTPGET,1);
 curl_setopt($ch, CURLOPT_RETURNTRANSFER,1);
 
//curl_setopt($ch , CURLOPT_POST, 1);
 //curl_setopt($ch , CURLOPT_POSTFIELDS, $contact);     

 $status_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);   //get status code
 $result=curl_exec($ch);
 $c_error=curl_error($ch);

 dpm($result);
 dpm('Curl error : '.$c_error);
 if ($c_error==""){dpm("No error");}

  

 curl_close($ch);



}




